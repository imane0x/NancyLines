import argparse
import random

from datasets import load_dataset


def create_fake_streets(id_to_fake):
    def fake_streets(sample):
        new_ways = []
        for way in sample["ways"]:
            if way.startswith("street_"):
                new_ways.append(id_to_fake[way.split("_")[-1]])
            else:
                new_ways.append(way)
        sample["ways"] = new_ways
        return sample
    return fake_streets


def main(args):
    data = load_dataset(args.input_data)["train"]

    real_streets = set([way for sample in data for way in sample["ways"] if not way.startswith("street_")])
    fake_streets = list(set(["rue des Lilas", "allée des Marronniers", "place de la République", "avenue Victor Hugo", "boulevard Pasteur", "impasse des Érables", "chemin du Moulin", "cours de la Gironde", "esplanade Jean Jaurès", "faubourg Saint-Honoré", "rue des Tilleuls", "allée des Glycines", "place du Marché", "avenue de la Liberté", "boulevard de Strasbourg", "impasse du Lavoir", "chemin de la Fontaine", "cours Gambetta", "esplanade des Arts", "faubourg des Vignes", "rue des Saules", "allée de la Brume", "place de l’Église", "avenue des Chênes", "boulevard Marie Curie", "impasse des Hiboux", "chemin des Cerisiers", "cours Napoléon", "esplanade du Lac", "faubourg de la Paix", "rue de la Gare", "allée du Zéphyr", "place de la Mairie", "avenue de Lille", "boulevard des Bateliers", "impasse du Souvenir", "chemin du Phare", "cours Mirabeau", "esplanade Simone Veil", "faubourg des Roses", "rue des Forgerons", "allée des Étoiles", "place du 14-Juillet", "avenue Gustave Eiffel", "boulevard des Oliviers", "impasse de l’Espoir", "chemin des Vignes", "cours de la Paix", "esplanade du Soleil", "faubourg des Tisserands", "rue de la Plage", "allée des Saules", "place de la Liberté", "avenue des Boulangers", "boulevard des Vignerons", "impasse des Rêves", "chemin des Algues", "cours de la République", "esplanade du Crépuscule", "faubourg des Charpentiers", "rue du Lavoir", "allée des Poiriers", "place Saint-Martin", "avenue de Marseille", "boulevard des Meuniers", "impasse du Silence", "chemin de la Mer", "cours Louis XIV", "esplanade des Vagues", "faubourg des Chapeliers", "rue de la Croix-Rousse", "allée des Marguerites", "place de la Victoire", "avenue Albert Camus", "boulevard des Ancres", "impasse du Ciel", "chemin de l’Horizon", "cours de l’Atlantique", "esplanade des Oiseaux", "faubourg des Cordiers", "rue Pierreuse", "allée des Cerisiers", "place du Théâtre", "avenue de Bordeaux", "boulevard des Forgerons", "impasse de la Lune", "chemin des Dunes", "cours de la Seine", "esplanade des Enfants", "faubourg des Oliviers", "rue des Acacias", "allée des Pins", "place du Commerce", "avenue de la Gare", "boulevard des Peupliers", "impasse des Capucines", "chemin de la Croix", "cours de la Libération", "esplanade des Tilleuls", "faubourg des Artisans", "rue des Tournesols", "allée des Violettes", "place de la Poste", "avenue des Lilas Blancs", "boulevard des Platanes", "impasse du Repos", "chemin des Sources", "cours de l’Europe", "esplanade des Cerisiers", "faubourg du Château", "rue des Chardonnerets", "allée des Rossignols", "place du Souvenir", "avenue des Vignes", "boulevard des Hirondelles", "impasse de la Source", "chemin de la Rivière", "cours des Écoles", "esplanade des Pivoines", "faubourg des Meuniers", "rue des Coquelicots", "allée des Primevères", "place de l’Hôtel de Ville", "avenue des Ormeaux", "boulevard des Bouleaux", "impasse des Liserons", "chemin du Puits", "cours de la Révolution", "esplanade des Jonquilles", "faubourg des Tanneurs", "rue des Orchidées", "allée des Nénuphars", "place de la Concorde", "avenue de la Résistance", "boulevard des Cyprès", "impasse des Myosotis", "chemin des Genêts", "cours des Halles", "esplanade des Tulipes", "faubourg des Teinturiers", "rue des Hortensias", "allée des Pâquerettes", "place de la Cathédrale", "avenue des Sorbiers", "boulevard des Aulnes", "impasse de la Rosée", "chemin des Roches", "cours du Général de Gaulle", "esplanade des Campanules", "faubourg des Selliers", "rue des Iris", "allée des Liserons", "place de la Bastille", "avenue des Troènes", "boulevard des Frênes", "impasse de la Brise", "chemin des Collines", "cours de la Paix", "esplanade des Pâquerettes", "faubourg des Cordonniers", "rue des Mimosas", "allée des Jasmins", "place de la Liberté", "avenue des Fusains", "boulevard des Mûriers", "impasse de l’Écho", "chemin des Bois", "cours de la Victoire", "esplanade des Bleuets", "faubourg des Verriers", "rue des Renoncules", "allée des Camélias", "place du 8-Mai-1945", "avenue des Houx", "boulevard des Noyers", "impasse du Printemps", "chemin de la Vallée", "cours des Nations", "esplanade des Marguerites", "faubourg des Tonneliers", "rue des Dahlias", "allée des Magnolias", "place du Souvenir Français", "avenue des Lauriers", "boulevard des Châtaigniers", "impasse de l’Automne", "chemin des Prés", "cours de la Résistance", "esplanade des Lavandes", "faubourg des Drapiers", "rue des Géraniums", "allée des Pivoines", "place de la Nation", "avenue des Érables Rouges", "boulevard des Pommiers", "impasse de l’Été", "chemin des Vignobles", "cours de la Liberté", "esplanade des Capucines", "faubourg des Tisserands", "rue des Pensées", "allée des Bruyères", "place du 11-Novembre", "avenue des Sauges", "boulevard des Noisetiers", "impasse de l’Hiver", "chemin des Coteaux", "cours de la République", "esplanade des Coquelicots", "faubourg des Maréchaux", "rue des Soucis", "allée des Fougères", "place du Général Leclerc", "avenue des Tamaris", "boulevard des Abricotiers", "impasse de l’Aube", "chemin de la Douceur", "cours des Fleurs", "esplanade des Renoncules", "faubourg des Charbonniers", "rue des Zinnias", "allée des Trèfles", "place du Maréchal Foch", "avenue des Cèdres", "boulevard des Pêchers", "impasse du Crépuscule", "chemin des Vergers", "cours des Écrivains", "esplanade des Myosotis", "faubourg des Bouchers", "rue des Anémones", "allée des Lys", "place du Colonel Fabien", "avenue des Mélèzes", "boulevard des Figuiers", "impasse de l’Ombre", "chemin des Landes", "cours des Poètes", "esplanade des Primevères", "faubourg des Pêcheurs", "rue des Pavots", "allée des Orties", "place du Docteur Schweitzer", "avenue des Bambous", "boulevard des Oliviers Sauvages", "impasse de la Nuit", "chemin des Vignes Blanches", "cours des Artistes", "esplanade des Violets", "faubourg des Pottiers", "rue des Bégonias", "allée des Chardons", "place de la Fraternité", "avenue des Papyrus", "boulevard des Amandiers", "impasse du Silence", "chemin des Ruisseaux", "cours des Musiciens", "esplanade des Marguerites Sauvages", "faubourg des Vanniers", "rue des Liserons Bleus", "allée des Bruyères Roses", "place de l’Abbé Pierre", "avenue des Palmiers", "boulevard des Griottes", "impasse du Mystère", "chemin des Falaises", "cours des Philosophes", "esplanade des Orchidées Sauvages", "faubourg des Fondeurs", "rue des Clématites", "allée des Sureau", "place de la Paix", "avenue des Lauriers Roses", "boulevard des Framboisiers", "impasse de l’Illusion", "chemin des Rizières", "cours des Historiens", "esplanade des Pétunias", "faubourg des Sculpteurs", "rue des Mûriers Blancs", "allée des Troènes Dorés", "place du Moulin à Vent", "avenue des Cèdres Bleus", "boulevard des Pervenches", "impasse des Glycines Pourpres", "chemin des Genévriers", "cours des Tanneurs", "esplanade des Colombes", "faubourg des Ébénistes", "rue des Feuillages", "allée des Buis", "place de la Douceur", "avenue des Grands Chênes", "boulevard des Ormes Pleureurs", "impasse du Papillon", "chemin des Lucioles", "cours des Étoilés", "esplanade des Brumes", "faubourg des Alchimistes", "rue des Murmures", "allée des Reflets", "place de l’Éternel Retour", "avenue des Soupirs", "boulevard des Ombres Longues", "impasse du Temps Perdu", "chemin des Rêveurs", "cours des Illusions", "esplanade des Promesses", "faubourg des Échos", "rue de la Mémoire Douce", "allée des Chuchotements", "place du Passé Simple", "avenue des Horizons Lointains", "boulevard des Regrets Évanouis", "impasse des Silences Dorés", "chemin des Heures Calmes", "cours des Nuits Blanches", "esplanade des Matins Clairets", "faubourg des Pensées Légères", "rue des Cœurs Vaillants", "allée des Âmes Sœurs", "place des Amours Perdues", "avenue des Premières Neiges", "boulevard des Feux Follets", "impasse des Lueurs d’Été", "chemin des Brises Marines", "cours des Vents du Sud", "esplanade des Cieux Ouverts", "faubourg des Nuages Blancs", "rue des Pluies Fines", "allée des Rosées Matinales", "place des Éclats de Lune", "avenue des Rayons d’Or", "boulevard des Éclairs de Génie", "impasse des Arcs-en-Ciel", "chemin des Couleurs Douces", "cours des Harmonies", "esplanade des Mélodies", "faubourg des Notes Bleues", "rue des Accords Parfaits", "allée des Refrains Anciens", "place des Chants d’Oiseaux", "avenue des Symphonies Silencieuses", "boulevard des Rimes Perdues", "impasse des Vers Oubliés", "chemin des Sonnets Endormis", "cours des Ballades Lointaines", "esplanade des Fables", "faubourg des Contes d’Hiver", "rue des Légendes Urbaines", "allée des Mythes Oubliés", "place des Héros Discrets", "avenue des Guerriers Pacifiques", "boulevard des Sages Modernes", "impasse des Visionnaires", "chemin des Penseurs Libres", "cours des Inventeurs Fous", "esplanade des Rêveurs Éveillés", "faubourg des Utopistes", "rue des Révolutions Douces", "allée des Réformes Sereines", "place des Changements Lents", "avenue des Futurs Proches", "boulevard des Mondes Possibles", "impasse des Portes Cachées", "chemin des Sentiers Secrets", "cours des Passages Oubliés", "esplanade des Clés Perdues", "faubourg des Cartes Anciennes", "rue des Boussoles Inversées", "allée des Étoiles Filantes", "place des Constellations Rares", "avenue des Planètes Voisines", "boulevard des Galaxies Endormies", "impasse des Univers Parallèles", "chemin des Dimensions Cachées", "cours des Temps Croisés", "esplanade des Éternités Brèves", "faubourg des Instants Éternels", "rue des Secondes Précieuses", "allée des Minutes Douces", "place des Heures Suspendues", "avenue des Journées Lointaines", "boulevard des Semaines Calmes", "impasse des Mois d’Été", "chemin des Saisons Croisées", "cours des Années Lumineuses", "esplanade des Siècles Doux", "faubourg des Millénaires Silencieux", "rue des Origines Perdues", "allée des Racines Profondes", "place des Ancêtres Oubliés", "avenue des Traditions Vives", "boulevard des Coutumes Anciennes", "impasse des Rites Simples", "chemin des Célébrations Secrètes", "cours des Fêtes Discrètes", "esplanade des Joies Modestes", "faubourg des Bonheurs Quotidiens", "rue des Plaisirs Simples", "allée des Détails Précieux", "place des Petits Riens", "avenue des Grands Silences", "boulevard des Mots Justes", "impasse des Gestes Tendres", "chemin des Regards Francs", "cours des Étreintes Sincères", "esplanade des Sourires Rares", "faubourg des Rires Légers", "rue des Larmes Sèches", "allée des Blessures Guéries", "place des Cœurs Apaisés", "avenue des Âmes Réconciliées", "boulevard des Esprits Libres", "impasse des Corps Fatigués", "chemin des Mains Jointes", "cours des Voix Douces", "esplanade des Pensées Claires", "faubourg des Intuitions Justes", "rue des Certitudes Fragiles", "allée des Doutes Féconds", "place des Questions Sans Réponse", "avenue des Réponses Imprévues", "boulevard des Paradoxes Évidents", "impasse des Vérités Relatives", "chemin des Mensonges Honnêtes", "cours des Illusions Utiles", "esplanade des Réalités Flexibles", "faubourg des Possibles Réels", "rue des Probabilités Minces", "allée des Chances Ténues", "place des Hasards Heureux", "avenue des Coïncidences Signifiantes", "boulevard des Destins Croisés", "impasse des Routes Abandonnées", "chemin des Bifurcations Secrètes", "cours des Carrefours Magiques", "esplanade des Directions Inconnues", "faubourg des Itinéraires Invisibles", "rue des Pas Perdus", "allée des Traces Effacées", "place des Empreintes Légères", "avenue des Sentiers de Lumière", "boulevard des Routes d’Étoiles", "impasse des Chemins de Lune", "chemin des Voies d’Eau", "cours des Courants Cachés", "esplanade des Flux Secrets", "faubourg des Sources Intérieures", "rue des Rivières Souterraines", "allée des Fleuves Invisibles", "place des Mers Intérieures", "avenue des Océans Calmes", "boulevard des Vagues Apaisées", "impasse des Marées Endormies", "chemin des Courants Profonds", "cours des Abysses Doux", "esplanade des Fonds Lumineux", "faubourg des Îles Lointaines", "rue des Continents Oubliés", "allée des Archipels Secrets", "place des Péninsules Tranquilles", "avenue des Caps Silencieux", "boulevard des Estuaires Paisibles", "impasse des Baies Sereines", "chemin des Lagons Cachés", "cours des Atolls Endormis", "esplanade des Récifs Colorés", "faubourg des Grèves Blanches", "rue des Dunes Dorées", "allée des Falaises Roses", "place des Coteaux Verts", "avenue des Vallons Ombragés", "boulevard des Plateaux Vents", "impasse des Sommets Doux", "chemin des Crêtes Ensoleillées", "cours des Cimes Voilées", "esplanade des Nuages Bas", "faubourg des Brumes Matinales", "rue des Brouillards Légers", "allée des Voiles de Brume", "place des Lumières Diffuses", "avenue des Ombres Douces", "boulevard des Pénombres Accueillantes", "impasse des Clair-Obscurs", "chemin des Lueurs Tremblantes", "cours des Éclats Furtifs", "esplanade des Reflets Mouvants", "faubourg des Miroitements", "rue des Éblouissements Doux", "allée des Scintillements Ténus", "place des Lueurs d’Aube", "avenue des Rayons Couchants", "boulevard des Feux du Soir", "impasse des Braises Éteintes", "chemin des Cendres Fécondes", "cours des Cœurs Ardents", "esplanade des Flammes Calmes", "faubourg des Brasiers Apaisés", "rue des Foyers Anciens", "allée des Fumées Légères", "place des Fumerolles Discrètes", "avenue des Souffles Chauds", "boulevard des Hales Fraîches", "impasse des Soupirs d’Air", "chemin des Courants d’Air", "cours des Zéphyrs Caressants", "esplanade des Brises Printanières", "faubourg des Vents d’Automne"]) - real_streets)
    random.shuffle(fake_streets)

    street_ids = list(set([way.split("_")[-1] for sample in data for way in sample["ways"] if way.startswith("street_")]))
    random.shuffle(street_ids)

    print(len(fake_streets), len(street_ids))
    if len(fake_streets) < len(street_ids):
        raise Exception("Not enough fake streets")

    id_to_fake = {street_id:fake_street for street_id, fake_street in zip(street_ids, fake_streets)}

    data = data.map(create_fake_streets(id_to_fake))

    data.to_parquet(args.output_data)
    

if __name__ == "__main__":
    parser = argparse.ArgumentParser(description='Gives fake street names instead of ids')
    parser.add_argument('--input_data', type=str, default="im21/pairs", help='Path to input dataset')
    parser.add_argument('--output_data', type=str, default="./data/fake_street/fake_street.parquet", help='Path to created dataset')
    args = parser.parse_args()
    main(args)